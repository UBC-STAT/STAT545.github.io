{
  "hash": "ac6289c702396ba183e5e3240e0064bd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Data Manipulation on FEV Dataset\"\nsubtitle: \"Lecture 3 Case Study\"\nformat: html\n---\n\n\n\n\nCopy the following code into a new RMarkdown Document, or download it [here](https://github.com/UBC-STAT/STAT545.github.io/blob/main/content/casestudies/casestudy_datamanipulation/casestudy_datamanipulation.Rmd).\n\n````         \n---\ntitle: 'FEV Case Study: Data Manipulation'\noutput: html_document\ndate: \"2025-07-31\"\n---\n\n\n\n## Introduction \n\nWe will perform exploratory data analysis of the `fev` data set. \nLet's start by getting the data set. Load the `readr` package (more on this later) and run `fev <- read_tsv(\"https://raw.githubusercontent.com/GTPB/PSLS20/master/data/fev.txt\")` to get access to it. Let's also load `dplyr` while we're at it - we'll need it to do the exercises! \n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"dplyr\") #uncomment and run once, if needed\n#install.packages(\"readr\") #uncomment and run once, if needed\n\nlibrary(dplyr)\nlibrary(readr)\nfev <- read_tsv(\"https://raw.githubusercontent.com/GTPB/PSLS20/master/data/fev.txt\")\nfev_tbl <- as_tibble(fev) %>% mutate(across(gender:smoking, ~ as.factor(.x))) #assign gender and smoking as factors (more on this later, too!)\n```\n:::\n\n## The `fev` data set \n\nIt is now widely believed that smoking tends to impair lung function. Much of the data to support this claim arises from studies of pulmonary function in adults who are long-time smokers. A question then arises whether such deleterious effects of smoking can be detected in children who smoke. To address this question, measures of lung function were made in about 600 children seen for a routine check up in a particular pediatric clinic. The children participating in this study were asked whether they were current smokers.\n\nA common measurement of lung function is the forced expiratory volume (FEV), which measures how much air you can blow out of your lungs in a short period of time. A higher FEV is usually associated with better respiratory function. It is well known that prolonged smoking diminishes FEV in adults, and those adults with diminished FEV also tend to have decreased pulmonary function as measured by other clinical variables, such as blood oxygen and carbon dioxide levels.\n\nData collected from the study on the relationship between smoking status and lung function (measured by FEV) in children are contained in the `fev_tbl` dataset. Here is a data dictionary:\n\n| Variable Name | Description | \n| :--: |:--: |\n| age           | subject age (years) | \n| fev           | measured forced exhalation volume (litres/second)| \n| height        | subject height (inches) | \n| gender        | subject gender (here, male or female) | \n| smoking         | smoking status (yes or no) | \n\n\nHere is a few rows of the data set:\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(fev_tbl)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 Ã— 5\n    age   fev height gender smoking\n  <dbl> <dbl>  <dbl> <fct>  <fct>  \n1     9  1.71   57   f      0      \n2     8  1.72   67.5 f      0      \n3     7  1.72   54.5 f      0      \n4     9  1.56   53   m      0      \n5     9  1.90   57   m      0      \n6     8  2.34   61   f      0      \n```\n\n\n:::\n:::\n\n\n## Understanding the data structure\n\n### Exercise 1\n\nAm I missing any variables compared to the data dictionary? Let's check. \n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE\n```\n:::\n\n### Exercise 2\n\nNext: are there any duplicate case numbers? Are there any duplicate subject IDs?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE\n```\n:::\n\nNow we know that no cases were entered twice, and each case corresponds to a different patient. \n\n## Understanding the patients in the study\n\n### Exercise 3\n\nLet's summarize the age of the patients first, by computing the mean, standard deviation, min, and max of the patient ages. \n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE\n```\n:::\n\nSomething's a little odd about these summaries. Remember: this is a smoking study on children.\n\n- Why would a 3 year old be enrolled in a smoking study?  \n- Why would a 19 year old be enrolled in a study on children? \n\n### Exercise 4\n\nI'm now a bit worried: what's the youngest patient who smokes in this dataset?\n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE \n```\n:::\n\nLooks like the youngest patient who smokes is 9. Seems young to me, but much less far-fetched than (say) 3. \n\n### Exercise 5\n\nWhat about the 19 year olds? Should they be included? The definition of a \"child\" can vary from study to study. Possible definitions include < 21 and < 18.  Let's find out who the patients 18 or older are and what their case numbers are so that we can ask our point of contact for the study about them. \n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE \n```\n:::\n\n**Aside**: if it turns out that we need to exclude any of these odd-looking patients from our final data analysis, then we will need to re-run everything after this point with their data removed. Isn't it nice that we are preparing this report in R Markdown?  \n\n### Exercise 6\n\nThis is a smoking study, so it seems useful to know what proportion of the study participants are smokers. In fact, let's break it down by sex, and calculate the proportion of girls who are smokers and the proportion of boys who are smokers, as well as the number of girls and the number of boys in the study. \n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE\n```\n:::\n\nThe proportion of girls who are smokers is higher than the proportion of boys that are smokers.\n\n### Exercise 7\n\nIs this because there are more smokers among teenage girls than teenage boys? Or is this a phenomenon that is uniform across age groups? To find out, let's calculate: \n\n- the proportion and number of girls aged 0-6 who are smokers\n- the proportion and number of girls aged 7-12 who are smokers \n- the proportion and number of girls aged 13-19 who are smokers\n- the proportion and number of boys aged 0-6 who are smokers\n- the proportion and number of boys aged 7-12 who are smokers \n- the proportion and number of boys aged 13-19 who are smokers\n\nHint: you will need to create a new variable that has three categories: age 0-6, age 7-12, and age 13-19. You can do so with `fev_tbl %>% mutate(age_cat = cut(age, c(0, 6, 12, 19)))`.\n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE\n```\n:::\n\nThere are no smokers (female or male) in the 0-6 group. There is a higher proportion of girls in the 7-12 group who are smokers than boys in the 7-12 group. Ditto the 13-19 group. \n\n## Does smoking have an effect on lung function? \n\nLet's continue exploring the data set with a closer eye to our main research question: does smoking have an effect on lung function in children? \n\n### Exercise 8\n\nLet's start by summarizing the FEV of the smokers and non-smokers. Let's calculate the mean, standard deviation, and number of observations in each group. We will mainly be comparing the means to gather information about the question, but the standard deviation and number of observations are important to look at too. \n\n::: {.cell}\n\n```{.r .cell-code}\n# FILL IN HERE\n```\n:::\nWe see that the mean FEV in the smoking group seems to be substantially higher than the average FEV in the non-smoking group. That is, the smokers appear to have *better* lung function than the non-smokers. \n\nDoes this surprise you? Recall that this is an observational study - children were not randomly assigned to smoke or not smoke. We might then have reason to suspect that the association between FEV and smoking status is confounded by some other factors. For example, \nwe already know that the youngest smoker in our data set is 9, while the non-smokers are as young as 3. This suggests that the smokers in our data set are generally older than the non-smokers. Furthermore, we might expect older children to have higher FEV, because they are bigger and have bigger lungs. Could age be a confounder here? Maybe the smoking group has higher lung function simply because they are older and bigger.\n\nWe will investigate this point next week after we have learned about graphing tools.\n````\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}